<!doctype html><html lang=vi class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=description content><meta name=author content="voankhangpt@gmail.com"><link rel=icon href=../../../images/favicon.png type=image/png><title>Blog 2 :: Báo cáo thực tập</title>
<link href=../../../css/nucleus.css?1765364014 rel=stylesheet><link href=../../../css/fontawesome-all.min.css?1765364014 rel=stylesheet><link href=../../../css/hybrid.css?1765364014 rel=stylesheet><link href=../../../css/featherlight.min.css?1765364014 rel=stylesheet><link href=../../../css/perfect-scrollbar.min.css?1765364014 rel=stylesheet><link href=../../../css/auto-complete.css?1765364014 rel=stylesheet><link href=../../../css/atom-one-dark-reasonable.css?1765364014 rel=stylesheet><link href=../../../css/theme.css?1765364014 rel=stylesheet><link href=../../../css/hugo-theme.css?1765364014 rel=stylesheet><link href=../../../css/theme-workshop.css?1765364014 rel=stylesheet><script src=../../../js/jquery-3.3.1.min.js?1765364014></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=../../../vi/3-blogstranslated/3.2-blog2/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=../../../><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=../../../js/lunr.min.js?1765364014></script><script type=text/javascript src=../../../js/auto-complete.js?1765364014></script><script type=text/javascript>var baseurl="https://khangvo05.github.io/vo-an-khang-fptse190618-internship-report//vi"</script><script type=text/javascript src=../../../js/search.js?1765364014></script></div><div class=highlightable><ul class=topics><li data-nav-id=/vi/1-worklog/ title="Nhật ký Công việc" class=dd-item><a href=../../../vi/1-worklog/><b>1. </b>Nhật ký Công việc
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/1-worklog/1.1-week1/ title="Nhật ký công việc Tuần 1" class=dd-item><a href=../../../vi/1-worklog/1.1-week1/><b>1.1. </b>Nhật ký công việc Tuần 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.2-week2/ title="Nhật ký công việc Tuần 2" class=dd-item><a href=../../../vi/1-worklog/1.2-week2/><b>1.2. </b>Nhật ký công việc Tuần 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.3-week3/ title="Nhật ký công việc Tuần 3" class=dd-item><a href=../../../vi/1-worklog/1.3-week3/><b>1.3. </b>Nhật ký công việc Tuần 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.4-week4/ title="Nhật ký công việc Tuần 4" class=dd-item><a href=../../../vi/1-worklog/1.4-week4/><b>1.4. </b>Nhật ký công việc Tuần 4
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.5-week5/ title="Nhật ký công việc Tuần 5" class=dd-item><a href=../../../vi/1-worklog/1.5-week5/><b>1.5. </b>Nhật ký công việc Tuần 5
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.6-week6/ title="Nhật ký công việc Tuần 6" class=dd-item><a href=../../../vi/1-worklog/1.6-week6/><b>1.6. </b>Nhật ký công việc Tuần 6
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.7-week7/ title="Nhật ký công việc Tuần 7" class=dd-item><a href=../../../vi/1-worklog/1.7-week7/><b>1.7. </b>Nhật ký công việc Tuần 7
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.8-week8/ title="Nhật ký công việc Tuần 8" class=dd-item><a href=../../../vi/1-worklog/1.8-week8/><b>1.8. </b>Nhật ký công việc Tuần 8
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.9-week9/ title="Nhật ký công việc Tuần 9" class=dd-item><a href=../../../vi/1-worklog/1.9-week9/><b>1.7. </b>Nhật ký công việc Tuần 9
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.10-week10/ title="Nhật ký công việc Tuần 10" class=dd-item><a href=../../../vi/1-worklog/1.10-week10/><b>1.8. </b>Nhật ký công việc Tuần 10
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.11-week11/ title="Nhật ký công việc Tuần 11" class=dd-item><a href=../../../vi/1-worklog/1.11-week11/><b>1.11. </b>Nhật ký công việc Tuần 11
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.12-week12/ title="Nhật ký công việc Tuần 12" class=dd-item><a href=../../../vi/1-worklog/1.12-week12/><b>1.12. </b>Nhật ký công việc Tuần 12
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.13-week13/ title="Nhật ký công việc Tuần 13" class=dd-item><a href=../../../vi/1-worklog/1.13-week13/><b>1.13. </b>Nhật ký công việc Tuần 13
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/2-proposal/ title="Bản đề xuất" class=dd-item><a href=../../../vi/2-proposal/><b>2. </b>Bản đề xuất
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/ title="Các bài blogs đã dịch" class="dd-item
parent"><a href=../../../vi/3-blogstranslated/><b>3. </b>Các bài blogs đã dịch
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/3-blogstranslated/3.1-blog1/ title="Blog 1" class=dd-item><a href=../../../vi/3-blogstranslated/3.1-blog1/><b>3.1. </b>Blog 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.2-blog2/ title="Blog 2" class="dd-item
active"><a href=../../../vi/3-blogstranslated/3.2-blog2/><b>3.2. </b>Blog 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.3-blog3/ title="Blog 3" class=dd-item><a href=../../../vi/3-blogstranslated/3.3-blog3/><b>3.3. </b>Blog 3
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/4-eventparticipated/ title="Các events đã tham gia" class=dd-item><a href=../../../vi/4-eventparticipated/><b>4. </b>Các events đã tham gia
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/4-eventparticipated/4.1-event1/ title="Sự Kiện 1" class=dd-item><a href=../../../vi/4-eventparticipated/4.1-event1/><b>4.1. </b>Sự Kiện 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.2-event2/ title="Sự kiện 2" class=dd-item><a href=../../../vi/4-eventparticipated/4.2-event2/><b>4.2. </b>Sự kiện 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.3-event3/ title="Sự kiện 3" class=dd-item><a href=../../../vi/4-eventparticipated/4.3-event3/><b>4.3. </b>Sự kiện 3
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/5-workshop/ title=Workshop class=dd-item><a href=../../../vi/5-workshop/><b>5. </b>Workshop
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/5-workshop/5.1-workshop-overview/ title="Giới thiệu" class=dd-item><a href=../../../vi/5-workshop/5.1-workshop-overview/><b>5.1. </b>Giới thiệu
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.2-prerequiste/ title="Các bước chuẩn bị" class=dd-item><a href=../../../vi/5-workshop/5.2-prerequiste/><b>5.2. </b>Các bước chuẩn bị
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.3-run-cloudformation-stack/ title="Thiết lập CloudFormation" class=dd-item><a href=../../../vi/5-workshop/5.3-run-cloudformation-stack/><b>5.3. </b>Thiết lập CloudFormation
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.4-set-up-website/ title="Thiết lập website" class=dd-item><a href=../../../vi/5-workshop/5.4-set-up-website/><b>5.4. </b>Thiết lập website
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.5-event-bridge/ title="Thiết lập EventBridge và Lambda" class=dd-item><a href=../../../vi/5-workshop/5.5-event-bridge/><b>5.5. </b>Thiết lập EventBridge và Lambda
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.6-sns/ title="Thiết lập SNS" class=dd-item><a href=../../../vi/5-workshop/5.6-sns/><b>5.6. </b>Thiết lập SNS
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.7-test-website-iot-connection/ title="Kiểm thử kết nối giữa website và thiết bị IoT" class=dd-item><a href=../../../vi/5-workshop/5.7-test-website-iot-connection/><b>5.7. </b>Kiểm thử kết nối giữa website và thiết bị IoT
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/6-self-evaluation/ title="Đánh giá bản thân" class=dd-item><a href=../../../vi/6-self-evaluation/><b>6. </b>Đánh giá bản thân
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/7-feedback/ title="Chia sẻ và Phản hồi" class=dd-item><a href=../../../vi/7-feedback/><b>7. </b>Chia sẻ và Phản hồi
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://khangvo05.github.io/vo-an-khang-fptse190618-internship-report/3-blogstranslated/3.2-blog2/>English</option><option id=vi value=https://khangvo05.github.io/vo-an-khang-fptse190618-internship-report/vi/3-blogstranslated/3.2-blog2/ selected>Tiếng Việt</option></select><svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><span id=lastUpdated style=color:orange></span>
</i><script>const today=new Date,formattedDate=today.toLocaleDateString("en-GB");document.getElementById("lastUpdated").textContent=formattedDate</script></left><left><br><br><b>Team</b><br><i><a href=https://www.facebook.com/groups/660548818043427 style=color:orange>First Cloud Journey</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=../../../vi/>Báo cáo thực tập</a> > <a href=../../../vi/3-blogstranslated/>Các bài blogs đã dịch</a> > Blog 2</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#cách-snapstart-hoạt-động>Cách SnapStart hoạt động</a></li><li><a href=#giải-thích-về-priming>Giải thích về Priming</a></li><li><a href=#ví-dụ-triển-khai-priming-sử-dụng-crac-runtime-hook-trước-khi-tạo-lambda-snapshot>Ví dụ triển khai priming sử dụng CRaC runtime hook trước khi tạo Lambda snapshot</a></li><li><a href=#kết-luận>Kết luận</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Blog 2</h1><h1 id=tối-ưu-hóa-hiệu-năng-cold-start-của-aws-lambda-sử-dụng-priming-với-snapstart>TỐI ƯU HÓA HIỆU NĂNG COLD START CỦA AWS LAMBDA SỬ DỤNG PRIMING VỚI SNAPSTART</h1><p>Được giới thiệu tại re:Invent 2022, <a href=https://docs.aws.amazon.com/lambda/latest/dg/snapstart.html>SnapStart</a> là một phương pháp tối ưu hóa hiệu năng giúp việc xây dựng các ứng dụng có khả năng phản hồi cao và mở rộng tốt bằng <a href=https://aws.amazon.com/lambda/>AWS Lambda</a> trở nên dễ dàng hơn. Yếu tố đóng góp lớn nhất vào độ trễ khởi động (thường được gọi là cold-start time) là thời gian dành cho việc khởi tạo một hàm. Quá trình này bao gồm việc tải mã nguồn của hàm và khởi tạo các dependency. Đối với các workload nhạy cảm về độ trễ như API và các ứng dụng xử lý dữ liệu thời gian thực, độ trễ khởi động cao có thể dẫn đến trải nghiệm người dùng cuối không tối ưu.</p><p>Lambda SnapStart có thể giảm thời gian khởi động từ vài giây xuống mức dưới một giây, với thay đổi code ở mức tối thiểu hoặc không cần thay đổi. Bài viết này thảo luận về &lsquo;Priming&rsquo;, một kỹ thuật để tối ưu hóa hơn nữa thời gian khởi động cho các hàm AWS Lambda được xây dựng bằng Java và Spring Boot.</p><p>Các ứng dụng Spring Boot thường gặp phải độ trễ cold start cao trong quá trình khởi tạo JVM và framework, nơi một lượng thời gian đáng kể được dành cho việc tải các class và thực hiện biên dịch Just-In-Time (JIT) mã Java bytecode. Bài đăng blog này sử dụng một ứng dụng Spring Boot làm ví dụ để truy xuất 10 bản ghi từ bảng UnicornEmployee trong cơ sở dữ liệu <a href=https://aws.amazon.com/rds/>Amazon RDS</a> for PostgreSQL, trong đó mỗi bản ghi nhân viên bao gồm tên, địa điểm và ngày tuyển dụng.</p><p>Ứng dụng mẫu sử dụng <a href=https://aws.amazon.com/api-gateway/>Amazon API Gateway</a> để kích hoạt một hàm AWS Lambda kết nối đến cơ sở dữ liệu thông qua RDS Proxy để trả về dữ liệu nhân viên. Mặc dù ứng dụng mẫu này sử dụng dữ liệu nhân viên giả để minh họa, các mẫu và kỹ thuật tối ưu hóa được thảo luận trong bài viết này có thể áp dụng cho các kịch bản thực tế với các mẫu truy cập dữ liệu tương tự.</p><p>Mã nguồn mẫu cho việc triển khai này có thể được tìm thấy trong kho GitHub của chúng tôi tại <a href=https://github.com/aws-samples/lambda-priming-crac-java-cdk>lambda-priming-crac-java-cdk</a>.</p><h3 id=cách-snapstart-hoạt-động>Cách SnapStart hoạt động</h3><p>Bài viết này giả định rằng người đọc đã quen thuộc với SnapStart và cung cấp một nền tảng ngắn gọn. Để biết thêm chi tiết, hãy tham khảo <a href=https://docs.aws.amazon.com/lambda/latest/dg/snapstart.html>SnapStart documentation</a>.</p><p>Tóm tắt nhanh, pha <a href=https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtime-environment.html>INIT</a> của một hàm Lambda bao gồm việc tải xuống mã nguồn của hàm, khởi động runtime và bất kỳ dependency bên ngoài nào, và chạy mã khởi tạo của hàm. Đối với các hàm không sử dụng SnapStart, pha này xảy ra mỗi khi ứng dụng của bạn mở rộng quy mô để tạo ra một execution environment mới. Khi SnapStart được kích hoạt, pha INIT xảy ra khi bạn publish một phiên bản của hàm.</p><p>Hình ảnh sau đây cho thấy sự so sánh vòng đời của một request Lambda khi có và không có SnapStart.</p><p><img src=https://awsstudygroup.com/wp-content/uploads/2025/10/image-455.png></p><p><em>Hình 1 – So sánh vòng đời của một request Lambda khi có và không có SnapStart</em></p><p>Vào cuối pha INIT, Lambda thực thi <a href=https://docs.aws.amazon.com/lambda/latest/dg/snapstart-runtime-hooks.html>runtime hooks</a> before-checkpoint của bạn. Lambda sau đó tạo snapshot trạng thái bộ nhớ và đĩa của execution environment đã được khởi tạo, lưu trữ snapshot đã được mã hóa và cache nó để truy cập với độ trễ thấp. Khi hàm được gọi sau đó, các execution environment mới sẽ được khôi phục từ snapshot đã được cache (trong pha <a href=https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtime-environment.html#runtimes-lifecycle-restore>RESTORE</a>), giúp tăng tốc độ khởi động của hàm.</p><p><img src=https://awsstudygroup.com/wp-content/uploads/2025/10/image-456.png></p><p><em>Hình 2 – Các execution environment mới được khôi phục từ snapshot đã được cache</em></p><p>Bạn có thể xác thực sự tăng tốc này bằng cách so sánh thời gian RESTORE với thời gian INIT được ghi lại trước khi có SnapStart trong Log <a href=https://aws.amazon.com/cloudwatch/>Amazon CloudWatch</a> của hàm Lambda. Như được minh họa trong bảng sau, việc bật SnapStart giúp giảm độ trễ khởi động của ứng dụng Spring Boot mẫu của chúng ta đi 4.3 lần, từ 6.1 giây xuống còn 1.4 giây. Độ trễ cold start 6.1 giây đối với ON_DEMAND chủ yếu là do sự kết hợp của (1) việc khởi tạo JVM và framework Spring Boot, (2) việc biên dịch JIT mã ứng dụng được tải lười (lazy loaded) trong lần gọi đầu tiên và (3) thời gian cần thiết để thiết lập kết nối cơ sở dữ liệu với RDS thông qua <a href=https://aws.amazon.com/rds/proxy/>Amazon RDS Proxy</a>. Bằng cách bật SnapStart, Lambda sẽ khởi tạo JVM và Spring Boot trước khi hàm được gọi – dẫn đến độ trễ giảm đáng kể còn 1.4 giây.</p><table><thead><tr><th style=text-align:left><strong>Method</strong></th><th style=text-align:left><strong>Cold Start Invocations</strong></th><th style=text-align:left><strong>p50</strong></th><th style=text-align:left><strong>p90</strong></th><th style=text-align:left><strong>p99</strong></th><th style=text-align:left><strong>p99.9</strong></th></tr></thead><tbody><tr><td style=text-align:left>PrimingLogGroup-1_ON_DEMAND</td><td style=text-align:left>128</td><td style=text-align:left>5047.94 ms</td><td style=text-align:left>5386.78 ms</td><td style=text-align:left>6158.80 ms</td><td style=text-align:left>6195.84 ms</td></tr><tr><td style=text-align:left>PrimingLogGroup-2_SnapStart_NO_PRIMING</td><td style=text-align:left>111</td><td style=text-align:left>1177.87 ms</td><td style=text-align:left>1288.73 ms</td><td style=text-align:left>1419.94 ms</td><td style=text-align:left>1425.63 ms</td></tr></tbody></table><p>Bạn có thể giảm cold start sâu hơn nữa cho các ứng dụng Spring Boot nhạy cảm về độ trễ của mình bằng cách sử dụng các kỹ thuật priming trên các hàm Lambda. Hãy cùng khám phá cách triển khai các kỹ thuật priming.</p><h3 id=giải-thích-về-priming>Giải thích về Priming</h3><p>Priming là quá trình tải trước các dependency và khởi tạo tài nguyên trong pha INIT, thay vì trong pha INVOKE, để tối ưu hóa hơn nữa hiệu năng khởi động với SnapStart. Điều này là cần thiết vì các framework Java sử dụng dependency injection sẽ tải các class vào bộ nhớ khi các class này được gọi một cách tường minh, điều này thường xảy ra trong pha INVOKE của Lambda. Bạn có thể chủ động tải các class bằng cách sử dụng <a href=https://docs.aws.amazon.com/lambda/latest/dg/snapstart-runtime-hooks-java.html>Java runtime hooks</a>, là một phần của dự án mã nguồn mở <a href=https://openjdk.org/projects/crac/>CRaC</a> (Coordinated Restore at Checkpoint). Bài viết này minh họa cách sử dụng hook này, được gọi là <code>beforeCheckpoint()</code>, để &ldquo;prime&rdquo; các hàm Java đã bật SnapStart, theo hai cách:</p><ol><li><p><strong>Invoke Priming:</strong> Cách tiếp cận này bao gồm việc trực tiếp gọi các endpoint hoặc method của ứng dụng trong hook trước khi tạo snapshot (pre-snapshotting hook) để chúng được biên dịch JIT trong pha INIT và được bao gồm trong snapshot. Việc này có thể bao gồm các hoạt động như gọi các endpoint của API Gateway hoặc lấy dữ liệu từ một bucket S3 hoặc cơ sở dữ liệu RDS để chủ động thực thi các luồng mã, đảm bảo rằng các class nền tảng được bao gồm trong snapshot.</p></li><li><p><strong>Class Priming:</strong> Cách tiếp cận này bao gồm việc khởi tạo chủ động các class trong pha INIT, đảm bảo rằng chúng được bao gồm trong snapshot của hàm mà không có nguy cơ gây ra những thay đổi không mong muốn cho trạng thái hoặc dữ liệu của ứng dụng. Điều này có thể đạt được bằng cách tận dụng method <code>forName()</code> của Java, method này sẽ tải, liên kết và khởi tạo class được chỉ định. &ldquo;Khởi tạo&rdquo; (Initialization) đề cập đến quá trình của JVM tải định nghĩa class vào bộ nhớ, xác minh bytecode, chuẩn bị các trường tĩnh với giá trị mặc định, và thực thi các bộ khởi tạo tĩnh. Điều này khác với &ldquo;khởi tạo đối tượng&rdquo; (instantiation), là quá trình tạo ra các đối tượng của class bằng cách sử dụng các hàm khởi tạo (constructor).</p></li></ol><p>Để tạo ra một danh sách các class cần thiết cho việc tải trước, bạn có thể sử dụng tùy chọn VM option sau, ghi danh sách ra một tệp có tên là <code>classes-loaded.txt</code>:</p><pre tabindex=0><code>-Xlog:class+load=info:classes-loaded.txt
</code></pre><p>Mặc dù invoke priming có thể mang lại hiệu năng tốt hơn, nó đòi hỏi nỗ lực bổ sung để đảm bảo rằng các hành động được thực hiện là idempotent (có thể thực hiện nhiều lần mà không thay đổi kết quả) và không có các tác dụng phụ không mong muốn, ví dụ như xử lý các giao dịch tài chính trong một ứng dụng ngân hàng. Vì lý do này, invoke priming chỉ nên được sử dụng khi mã được thực thi trong quá trình priming là idempotent hoặc không làm thay đổi trạng thái. Đối với các kịch bản không thể làm được điều này, class priming cung cấp một giải pháp thay thế an toàn hơn bằng cách chỉ khởi tạo các class mà không thực thi các method của chúng. Lưu ý rằng điều này giả định ứng dụng của bạn không thực thi mã thay đổi trạng thái trong quá trình khởi tạo class.</p><p>Với bối cảnh này, hãy xem cách triển khai Invoke priming và Class priming cho một ứng dụng Spring Boot mẫu.</p><h3 id=ví-dụ-triển-khai-priming-sử-dụng-crac-runtime-hook-trước-khi-tạo-lambda-snapshot>Ví dụ triển khai priming sử dụng CRaC runtime hook trước khi tạo Lambda snapshot</h3><p>Bài viết này minh họa cả Invoke priming và Class priming bằng cách sử dụng ứng dụng Spring Boot mẫu. Việc lựa chọn giữa hai phương pháp phụ thuộc vào các yêu cầu và độ phức tạp cụ thể của ứng dụng của bạn.</p><p><strong>Bước 1:</strong> Thiết lập ứng dụng Spring Boot của bạn</p><p>Thiết lập ứng dụng Spring Boot của bạn bằng cách sử dụng <code>aws-serverless-springboot3-archetype</code> như đã giải thích trong hướng dẫn <a href=https://github.com/aws/serverless-java-container/wiki/Quick-start---Spring-Boot3>Quick Start Spring Boot3</a> của chúng tôi, thêm mã kết nối cơ sở dữ liệu, hoặc đơn giản là clone dự án mẫu từ <a href=https://github.com/aws-samples/lambda-priming-crac-java-cdk>GitHub repository</a>.</p><ol><li>Tạo một ứng dụng Spring Boot.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>//src/main/java/software/amazon/awscdk/examples/unicorn/UnicornApplication.java</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> software.amazon.awscdk.examples.unicorn;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Import</span>({ UnicornConfig.<span style=color:#a6e22e>class</span> })
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootApplication</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UnicornApplication</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> Logger log <span style=color:#f92672>=</span> LoggerFactory.<span style=color:#a6e22e>getLogger</span>(UnicornApplication.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> arguments) {
</span></span><span style=display:flex><span>        SpringApplication.<span style=color:#a6e22e>run</span>(UnicornApplication.<span style=color:#a6e22e>class</span>, arguments);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=2><li>Thêm tất cả các Maven dependency cần thiết</li></ol><p>Thêm các dependency cho Spring Boot, AWS Lambda, và Kết nối Cơ sở dữ liệu vào tệp <a href=https://github.com/aws-samples/lambda-priming-crac-java-cdk/blob/main/software/priming/pom.xml>pom.xml</a> của bạn. Dependency sau đây chứa các class cần thiết để sử dụng các CRaC runtime hook:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.crac<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>crac<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=3><li>Cấu hình kết nối cơ sở dữ liệu</li></ol><p>Thiết lập chi tiết kết nối cơ sở dữ liệu trong tệp <code>application.properties</code>.</p><pre tabindex=0><code>spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}
spring.datasource.url=${SPRING_DATASOURCE_URL}
spring.datasource.username=postgres
spring.datasource.hikari.maximumPoolSize=1
</code></pre><p><strong>Bước 2:</strong> Triển khai Lambda Function Handler với CRaC runtime hook và Phương pháp Invoke Priming</p><p>Tạo Lambda Function Handler và tích hợp các CRaC runtime hook để thực thi các method <code>beforeCheckpoint()</code> và <code>afterRestore()</code> trong ứng dụng của bạn trước khi tạo và sau khi khôi phục snapshot.</p><ol><li><p>Triển khai interface <code>RequestHandler&lt;UnicornRequest, UnicornResponse></code> trong class handler của hàm Lambda.</p></li><li><p>Triển khai interface <code>Resource</code> của CRaC với hai method: <code>beforeCheckpoint()</code> và <code>afterRestore()</code>, định nghĩa các hành động được thực hiện trước khi Lambda tạo snapshot và sau khi snapshot được khôi phục.</p></li><li><p>Thêm invoke priming bằng cách tạo một đối tượng UnicornRequest với một request GET đến một endpoint cụ thể (ví dụ: <code>/unicorn</code>) và gọi method <code>handleRequest(unicornRequest, null)</code>.</p></li></ol><p>Điều này đảm bảo rằng các luồng mã liên quan đến endpoint được chỉ định sẽ được biên dịch JIT và tối ưu hóa để thực thi nhanh hơn trong lần gọi đầu tiên sau khi snapshot được khôi phục.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>//src/main/java/software/amazon/awscdk/examples/unicorn/handler/InvokePriming.java</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> software.amazon.awscdk.examples.unicorn.handler;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.crac.Core;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.crac.Resource;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>InvokePriming</span> <span style=color:#66d9ef>implements</span> RequestHandler<span style=color:#f92672>&lt;</span>APIGatewayV2HTTPEvent, APIGatewayV2HTTPResponse<span style=color:#f92672>&gt;</span>, Resource {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> APIGatewayV2HTTPResponse <span style=color:#a6e22e>handleRequest</span>(APIGatewayV2HTTPEvent event, Context context) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> awsLambdaInitializationType <span style=color:#f92672>=</span> System.<span style=color:#a6e22e>getenv</span>(<span style=color:#e6db74>&#34;AWS_LAMBDA_INITIALIZATION_TYPE&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> unicorns <span style=color:#f92672>=</span> getUnicorns();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> body <span style=color:#f92672>=</span> gson.<span style=color:#a6e22e>toJson</span>(unicorns);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> APIGatewayV2HTTPResponse.<span style=color:#a6e22e>builder</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>withStatusCode</span>(200)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>withBody</span>(body)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>beforeCheckpoint</span>(org.<span style=color:#a6e22e>crac</span>.<span style=color:#a6e22e>Context</span><span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>extends</span> Resource<span style=color:#f92672>&gt;</span> context) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> event <span style=color:#f92672>=</span> APIGatewayV2HTTPEvent.<span style=color:#a6e22e>builder</span>().<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>        handleRequest(event, <span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Bước 3:</strong> Triển khai Phương pháp Class priming</p><p>Phương pháp class priming tập trung vào việc tải trước các class cần thiết để đạt được hiệu năng tối ưu. Để triển khai class priming, hãy tạo danh sách các class được tải trong quá trình khởi động ứng dụng và thực thi hàm bằng cách chạy ứng dụng cục bộ với JVM argument sau:</p><pre tabindex=0><code>-Xlog:class+load=info:classes-loaded.txt
</code></pre><ol><li>Đảm bảo rằng các class ứng dụng của bạn có trong tệp <code>classes-loaded.txt</code> được tạo ra không làm thay đổi trạng thái trong quá trình khởi tạo tĩnh.</li></ol><p><strong>Lưu ý:</strong> tệp <code>classes-loaded.txt</code> được tạo ra chứa các mục class ở định dạng sau:</p><pre tabindex=0><code>[0.068s][info][class,load]software.amazon.awscdk.examples.unicorn.handler.ClassPriming source: file:/var/task/
</code></pre><ol start=2><li>Trích xuất danh sách các class từ tệp</li></ol><p>Chỉ trích xuất các tên class đủ điều kiện (fully qualified class names) từ mỗi dòng và loại bỏ thông tin ghi log bổ sung. Ví dụ:</p><pre tabindex=0><code>software.amazon.awscdk.examples.unicorn.handler.ClassPriming
</code></pre><ol start=3><li>Sử dụng method tiện ích <code>ClassLoaderUtil.loadClassesFromFile()</code> để trích xuất các mục class đã được tạo.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>//src/main/java/software/amazon/awscdk/examples/unicorn/service/ClassLoaderUtil.java</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> software.amazon.awscdk.examples.unicorn.service;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ClassLoaderUtil</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>loadClassesFromFile</span>() {
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;loadClassesFromFile-&gt;started&#34;</span>);
</span></span><span style=display:flex><span>        Path path <span style=color:#f92672>=</span> Paths.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;classes-loaded.txt&#34;</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> (BufferedReader bufferedReader <span style=color:#f92672>=</span> Files.<span style=color:#a6e22e>newBufferedReader</span>(path)) {
</span></span><span style=display:flex><span>            Stream<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> lines <span style=color:#f92672>=</span> bufferedReader.<span style=color:#a6e22e>lines</span>();
</span></span><span style=display:flex><span>            lines.<span style=color:#a6e22e>forEach</span>(line <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> index1 <span style=color:#f92672>=</span> line.<span style=color:#a6e22e>indexOf</span>(<span style=color:#e6db74>&#34;[class,load]&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> index2 <span style=color:#f92672>=</span> line.<span style=color:#a6e22e>indexOf</span>(<span style=color:#e6db74>&#34; source: &#34;</span>);
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (index1 <span style=color:#f92672>&lt;</span> 0 <span style=color:#f92672>||</span> index2 <span style=color:#f92672>&lt;</span> 0) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> className <span style=color:#f92672>=</span> line.<span style=color:#a6e22e>substring</span>(index1 <span style=color:#f92672>+</span> 13, index2);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>                    Class.<span style=color:#a6e22e>forName</span>(className, <span style=color:#66d9ef>true</span>, ClassPriming.<span style=color:#a6e22e>class</span>.<span style=color:#a6e22e>getClassLoader</span>());
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>catch</span> (Throwable ignored) {
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;loadClassesFromFile-&gt;finished&#34;</span>);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (IOException exception) {
</span></span><span style=display:flex><span>            log.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Error on newBufferedReader&#34;</span>, exception);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=4><li><p>Đọc một tệp (ví dụ: <code>/classes-loaded.txt</code>) chứa danh sách các class đã được tải trong quá trình thực thi của ứng dụng trong method <code>beforeCheckpoint()</code>.</p></li><li><p>Sử dụng method <code>Class.forName()</code> để tải và khởi tạo class, đảm bảo rằng nó đã sẵn sàng trong quá trình tạo snapshot.</p></li></ol><p><strong>Lưu ý</strong>: bằng cách tải trước các class này một cách có hệ thống, phương pháp Class priming giúp đơn giản hóa quá trình tối ưu hóa và giảm bớt sự phức tạp liên quan đến Invoke priming.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>//src/main/java/software/amazon/awscdk/examples/unicorn/handler/ClassPriming.java</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> software.amazon.awscdk.examples.unicorn.handler;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.crac.Core;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.crac.Resource;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ClassPriming</span> <span style=color:#66d9ef>implements</span> RequestHandler<span style=color:#f92672>&lt;</span>APIGatewayV2HTTPEvent, APIGatewayV2HTTPResponse<span style=color:#f92672>&gt;</span>, Resource {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ClassPriming</span>() {
</span></span><span style=display:flex><span>        ConfigurableApplicationContext configurableApplicationContext <span style=color:#f92672>=</span> SpringApplication.<span style=color:#a6e22e>run</span>(UnicornApplication.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>unicornService</span> <span style=color:#f92672>=</span> configurableApplicationContext.<span style=color:#a6e22e>getBean</span>(UnicornService.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>gson</span> <span style=color:#f92672>=</span> configurableApplicationContext.<span style=color:#a6e22e>getBean</span>(Gson.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>        Core.<span style=color:#a6e22e>getGlobalContext</span>().<span style=color:#a6e22e>register</span>(<span style=color:#66d9ef>this</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> APIGatewayV2HTTPResponse <span style=color:#a6e22e>handleRequest</span>(APIGatewayV2HTTPEvent event, Context context) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> unicorns <span style=color:#f92672>=</span> getUnicorns();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> body <span style=color:#f92672>=</span> gson.<span style=color:#a6e22e>toJson</span>(unicorns);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> APIGatewayV2HTTPResponse.<span style=color:#a6e22e>builder</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>withStatusCode</span>(200)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>withBody</span>(body)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>beforeCheckpoint</span>(org.<span style=color:#a6e22e>crac</span>.<span style=color:#a6e22e>Context</span><span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>extends</span> Resource<span style=color:#f92672>&gt;</span> context) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>        ClassLoaderUtil.<span style=color:#a6e22e>loadClassesFromFile</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Bước 4:</strong> Thiết lập Cơ sở hạ tầng AWS CDK</p><p>Trước khi tiếp tục, hãy xem lại các điều kiện tiên quyết trong tệp <a href=https://github.com/aws-samples/lambda-priming-crac-java-cdk/tree/main#requirements>README</a> của dự án.</p><p>CDK stack sẽ triển khai một ứng dụng serverless và cơ sở hạ tầng cần thiết để kiểm thử các chiến lược tối ưu hóa Lambda khác nhau. Nó tạo ra một VPC với các private subnet, một instance RDS for PostgreSQL với một database proxy, và năm hàm Lambda triển khai các phương pháp tối ưu hóa khác nhau (ON_DEMAND không có SnapStart, SnapStart không có priming, SnapStart với invoke priming, và SnapStart với class priming). Mỗi hàm Lambda được tích hợp với API Gateway để truy cập HTTP, được cấu hình với runtime Java 21 trên kiến trúc ARM64, và bao gồm các log group CloudWatch để giám sát.</p><p>Thực hiện theo các bước sau để triển khai cơ sở hạ tầng:</p><ol><li>Clone repository mẫu:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/aws-samples/lambda-priming-crac-java-cdk.git
</span></span></code></pre></div><ol start=2><li>Triển khai CDK stack:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd lambda-priming-crac-java-cdk/infrastructure
</span></span><span style=display:flex><span>cdk synth
</span></span><span style=display:flex><span>cdk deploy --require-approval never --all 2&gt;&amp;<span style=color:#ae81ff>1</span> | tee cdk_output.txt
</span></span></code></pre></div><ol start=3><li>Lưu các URL của API Gateway</li></ol><p>Việc triển khai sẽ xuất ra năm URL ở định dạng này:</p><pre tabindex=0><code># Endpoint ON_DEMAND (không có SnapStart)
LambdaPrimingCracJavaCdkStack.PrimingJavaRestApi1ONDEMANDEndpoint = https://[id].execute-api.us-east-1.amazonaws.com/prod/

# Endpoint SnapStart không có priming
LambdaPrimingCracJavaCdkStack.PrimingJavaRestApi2SnapStartNOPRIMINGEndpoint = https://[id].execute-api.us-east-1.amazonaws.com/prod/

# Endpoint SnapStart với invoke priming
LambdaPrimingCracJavaCdkStack.PrimingJavaRestApi3SnapStartINVOKEPRIMINGEndpoint = https://[id].execute-api.us-east-1.amazonaws.com/prod/

# Endpoint SnapStart với class priming
LambdaPrimingCracJavaCdkStack.PrimingJavaRestApi4SnapStartCLASSPRIMINGEndpoint = https://[id].execute-api.us-east-1.amazonaws.com/prod/

# Endpoint thiết lập cơ sở dữ liệu
LambdaPrimingCracJavaCdkStack.PrimingJavaRestApi5DBLOADEREndpoint = https://[id].execute-api.us-east-1.amazonaws.com/prod/
</code></pre><ol start=4><li>Trích xuất các URL vào các biến để kiểm thử:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ONDEMAND_URL<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep -oE <span style=color:#e6db74>&#39;https://[a-zA-Z0-9.-]+\.execute-api\.[a-zA-Z0-9-]+\.amazonaws\.com/prod/&#39;</span> <span style=color:#e6db74>&#34;cdk_output.txt&#34;</span> | head -n 1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>NOPRIMING_URL<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep -oE <span style=color:#e6db74>&#39;https://[a-zA-Z0-9.-]+\.execute-api\.[a-zA-Z0-9-]+\.amazonaws\.com/prod/&#39;</span> <span style=color:#e6db74>&#34;cdk_output.txt&#34;</span> | head -n <span style=color:#ae81ff>2</span> | tail -n 1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>INVOKEPRIMING_URL<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep -oE <span style=color:#e6db74>&#39;https://[a-zA-Z0-9.-]+\.execute-api\.[a-zA-Z0-9-]+\.amazonaws\.com/prod/&#39;</span> <span style=color:#e6db74>&#34;cdk_output.txt&#34;</span> | head -n <span style=color:#ae81ff>3</span> | tail -n 1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>CLASSPRIMING_URL<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep -oE <span style=color:#e6db74>&#39;https://[a-zA-Z0-9.-]+\.execute-api\.[a-zA-Z0-9-]+\.amazonaws\.com/prod/&#39;</span> <span style=color:#e6db74>&#34;cdk_output.txt&#34;</span> | head -n <span style=color:#ae81ff>4</span> | tail -n 1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>SETUP_URL<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep -oE <span style=color:#e6db74>&#39;https://[a-zA-Z0-9.-]+\.execute-api\.[a-zA-Z0-9-]+\.amazonaws\.com/prod/&#39;</span> <span style=color:#e6db74>&#34;cdk_output.txt&#34;</span> | head -n <span style=color:#ae81ff>5</span> | tail -n 1<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><p><strong>Bước 5:</strong> Tải dữ liệu cơ sở dữ liệu và chạy kiểm tra hiệu năng</p><ol><li>Khởi tạo cơ sở dữ liệu với dữ liệu mẫu:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X GET <span style=color:#e6db74>&#34;</span>$SETUP_URL<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Kết quả mong đợi: {&#34;message&#34;:&#34;Database schema initialized and data loaded&#34;}</span>
</span></span></code></pre></div><ol start=2><li>Chạy kiểm tra hiệu năng cho tất cả các endpoint:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>artillery run -t <span style=color:#e6db74>&#34;</span>$ONDEMAND_URL<span style=color:#e6db74>&#34;</span> -v <span style=color:#e6db74>&#39;{ &#34;url&#34;: &#34;/unicorn&#34; }&#39;</span> ./loadtest.yaml <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>artillery run -t <span style=color:#e6db74>&#34;</span>$NOPRIMING_URL<span style=color:#e6db74>&#34;</span> -v <span style=color:#e6db74>&#39;{ &#34;url&#34;: &#34;/unicorn&#34; }&#39;</span> ./loadtest.yaml <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>artillery run -t <span style=color:#e6db74>&#34;</span>$INVOKEPRIMING_URL<span style=color:#e6db74>&#34;</span> -v <span style=color:#e6db74>&#39;{ &#34;url&#34;: &#34;/unicorn&#34; }&#39;</span> ./loadtest.yaml <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>artillery run -t <span style=color:#e6db74>&#34;</span>$CLASSPRIMING_URL<span style=color:#e6db74>&#34;</span> -v <span style=color:#e6db74>&#39;{ &#34;url&#34;: &#34;/unicorn&#34; }&#39;</span> ./loadtest.yaml
</span></span></code></pre></div><p><strong>Bước 6:</strong> So sánh kết quả kiểm tra tải</p><p>Kết quả kiểm tra hiệu năng trong bảng dưới đây được sắp xếp từ độ trễ khởi động chậm nhất đến nhanh nhất. Hàm không có SnapStart hoạt động chậm nhất do việc khởi tạo JVM, tải class và biên dịch JIT xảy ra khi hàm được gọi. Chú ý đến sự cải thiện 4.3 lần với SnapStart, vốn khôi phục các lệnh gọi từ một snapshot đã được khởi tạo trước, do đó tránh được việc khởi tạo JVM và biên dịch JIT ban đầu.</p><p>SnapStart với class priming đạt được tốc độ nhanh hơn 1.4 lần so với SnapStart thông thường, bằng cách chủ động tải/khởi tạo các class trong pha INIT để chúng được bao gồm trong snapshot của hàm bạn. Cuối cùng, SnapStart với invoke priming đạt được hiệu năng nhanh nhất – với độ trễ cold-start p99.9 là 781.68ms, nhanh hơn 1.8 lần so với SnapStart. Điều này là do ngoài việc khởi tạo các class, nó còn thực thi các method trên các instance của những class đó, dẫn đến việc có nhiều thành phần hơn được đưa vào snapshot của hàm.</p><table><thead><tr><th style=text-align:left><strong>Method</strong></th><th style=text-align:left><strong>Cold Start Invocations</strong></th><th style=text-align:left><strong>p50</strong></th><th style=text-align:left><strong>p90</strong></th><th style=text-align:left><strong>p99</strong></th><th style=text-align:left><strong>p99.9</strong></th></tr></thead><tbody><tr><td style=text-align:left>PrimingLogGroup-1_ON_DEMAND</td><td style=text-align:left>128</td><td style=text-align:left>5047.94 ms</td><td style=text-align:left>5386.78 ms</td><td style=text-align:left>6158.80 ms</td><td style=text-align:left>6195.84 ms</td></tr><tr><td style=text-align:left>PrimingLogGroup-2_SnapStart_NO_PRIMING</td><td style=text-align:left>111</td><td style=text-align:left>1177.87 ms</td><td style=text-align:left>1288.73 ms</td><td style=text-align:left>1419.94 ms</td><td style=text-align:left>1425.63 ms</td></tr><tr><td style=text-align:left>PrimingLogGroup-4_SnapStart_CLASS_PRIMING</td><td style=text-align:left>82</td><td style=text-align:left>857.81 ms</td><td style=text-align:left>997.49 ms</td><td style=text-align:left>1085.94 ms</td><td style=text-align:left>1085.94 ms</td></tr><tr><td style=text-align:left>PrimingLogGroup-3_SnapStart_INVOKE_PRIMING</td><td style=text-align:left>66</td><td style=text-align:left>608.42 ms</td><td style=text-align:left>688.88 ms</td><td style=text-align:left>781.68 ms</td><td style=text-align:left>781.68 ms</td></tr></tbody></table><p>Lưu ý rằng với invoke priming, bất kỳ mã ứng dụng nào bạn thực thi phải là idempotent hoặc chỉ sửa đổi dữ liệu giả (stub data). Ví dụ, hãy xem xét mã ứng dụng kích hoạt một giao dịch tài chính. Nếu mã này được thực thi trong quá trình invoke priming với dữ liệu người dùng thật, nó có thể gây ra các hiệu ứng không mong muốn với những hậu quả tiềm tàng nghiêm trọng. Class priming tránh được điều này, vì các class ứng dụng được khởi tạo thay vì được tạo đối tượng (instantiated) và thực thi các method của chúng. Điều này giả định rằng mã ứng dụng không thực thi logic sửa đổi trạng thái trong quá trình khởi tạo class.</p><h3 id=kết-luận>Kết luận</h3><p>Bài viết này đã chỉ ra cách AWS Lambda SnapStart, được tăng cường bởi các CRaC runtime hook, mở ra khả năng kiểm soát chi tiết việc tối ưu hóa cold-start cho các ứng dụng Java thông qua hai chiến lược priming riêng biệt:</p><ul><li><strong>Invoke Priming:</strong> Cải thiện hiệu năng bằng cách thực thi các endpoint quan trọng trong quá trình tạo snapshot, lý tưởng cho các luồng công việc idempotent.</li><li><strong>Class Priming:</strong> Tải trước các class mà không kích hoạt business logic, giúp giảm thiểu rủi ro về tác dụng phụ.</li></ul><p>Để triển khai các kỹ thuật tối ưu hóa này trong ứng dụng của bạn, hãy đánh giá trường hợp sử dụng của bạn và chọn phương pháp priming tối ưu. Theo dõi sự sụt giảm độ trễ và việc sử dụng tài nguyên của ứng dụng thông qua các metric của Amazon CloudWatch để định lượng các cải tiến về hiệu năng. Bằng cách tích hợp các chiến lược này, các nhà phát triển có thể đạt được cold start dưới một giây trong khi vẫn duy trì khả năng mở rộng và hiệu quả chi phí của kiến trúc serverless khi sử dụng Java.</p><p>Để tìm hiểu sâu hơn, hãy xem <a href=https://github.com/aws-samples/lambda-priming-crac-java-cdk>GitHub repository</a> với mã nguồn ví dụ đầy đủ, bao gồm hướng dẫn thiết lập và các mẫu có thể tái sử dụng mà bạn có thể điều chỉnh cho các dự án của riêng mình. Để có thêm nhiều <a href="https://serverlessland.com/repos?services=lambda&runtime=Java">ví dụ về ứng dụng Java chạy bằng Lambda</a>, hãy truy cập <a href=https://serverlessland.com/>serverlessland.com</a> và khám phá nhiều loại tài nguyên, hướng dẫn và các trường hợp sử dụng thực tế.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=../../../vi/3-blogstranslated/3.1-blog1/ title="Blog 1"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=../../../vi/3-blogstranslated/3.3-blog3/ title="Blog 3" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=../../../js/clipboard.min.js?1765364014></script><script src=../../../js/perfect-scrollbar.min.js?1765364014></script><script src=../../../js/perfect-scrollbar.jquery.min.js?1765364014></script><script src=../../../js/jquery.sticky.js?1765364014></script><script src=../../../js/featherlight.min.js?1765364014></script><script src=../../../js/highlight.pack.js?1765364014></script><script>hljs.initHighlightingOnLoad()</script><script src=../../../js/modernizr.custom-3.6.0.js?1765364014></script><script src=../../../js/learn.js?1765364014></script><script src=../../../js/hugo-learn.js?1765364014></script><link href=../../../mermaid/mermaid.css?1765364014 rel=stylesheet><script src=../../../mermaid/mermaid.js?1765364014></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date),(i=t.createElement(n),a=t.getElementsByTagName(n)[0]),i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>